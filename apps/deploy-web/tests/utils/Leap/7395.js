"use strict";(self.webpackChunk_leap_cosmos_extension=self.webpackChunk_leap_cosmos_extension||[]).push([[7395],{734770:(ne,j,t)=>{t.d(j,{a:()=>e,u:()=>D});var l=t(964266),n=t(564510),F=t(202784),J=t(472565),L=t.n(J),B=t(164012),Q=t(840575),N=t(574358);async function D(R,k,U,h){return!!(await(await n.tgY.create(R,n.oCA.secret.chainId,h)).getBalance(h,U,k)).balance}function e(){const R=(0,N.E)(),k=(0,Q.iJ)(),U=(0,l.VMC)(),h=l.rNU.useOperateCosmosTx(),{setViewingKeys:z}=(0,l.WdY)();return(0,F.useCallback)(async(Z,H,I,V,q,Y)=>{const te=await R(),_=await n.KQf.create(Z??"",H,te);let P=Y?.key;if(q){if(!await D(Z??"",P??"",V,I))return{validKey:!1,error:"Invalid viewing key",key:P}}else try{const{txStatus:E,viewingKey:A}=await _.createViewingKey(I,V,U,{key:P,gasLimit:Y?.gasLimit,feeDenom:Y?.feeDenom});if(E.code!==0)return{validKey:!1,error:E.rawLog};h({txHash:E.transactionHash,txType:l.pb0.SecretTokenTransaction,metadata:{contract:V},feeDenomination:"uscrt",feeQuantity:E.tx?.auth_info?.fee?.amount?.[0]?.amount??"0.01",chainId:H}),P=A}catch{return{validKey:!1,error:"Unable to create viewing key"}}const ee=(0,n.HIp)(P,k),$=(await L().storage.local.get([B.rg]))[B.rg];if($){const E=A=>({...$,[I]:{...$[I],[V]:A?ee:P}});await L().storage.local.set({[B.rg]:E(!0)}),z(E(!1))}else{const E=A=>({[I]:{[V]:A?ee:P}});await L().storage.local.set({[B.rg]:E(!0)}),z(E(!1))}return{validKey:!0,error:null,key:P}},[R,k,U,h,z])}},574358:(ne,j,t)=>{t.d(j,{E:()=>Q});var l=t(964266),n=t(395362),F=t(840575),J=t(202784),L=t(444318),B=t.n(L);function Q(){const N=(0,l.rTu)(),D=(0,F.iJ)();return(0,J.useCallback)(async()=>{const e=(0,n.pe)(N?.cipher,D);return await new L.Wallet(e,{hdAccountIndex:N?.addressIndex})},[D,N])}},867395:(ne,j,t)=>{t.r(j),t.d(j,{default:()=>Ee});var l=t(964266),n=t(339279),F=t(294184),J=t.n(F),L=t(754699),B=t(892742),Q=t(702860),N=t(905865),D=t(508181),e=t(202784),R=t(410289),k=t(712878),U=t(240483),h=t(94608);function z({isVisible:o,onClose:c,token:a,onCreateViewingKey:s,onUpdateViewingKey:C,onImportViewingKey:r}){const y=(0,N.a)();return e.createElement(U.Z,{isOpen:o,onClose:c,title:"Add Token"},e.createElement("div",null,e.createElement("div",{className:"mb-4 px-5"},e.createElement("div",{className:"flex items-center"},e.createElement("img",{src:a?.icon===""?y:a?.icon,className:"h-[32px] w-[32px] mr-3"}),e.createElement(h.Z,{size:"xxl"},a?.symbol)),e.createElement(h.Z,{size:"md",className:"font-bold text-gray-200"},a?.name)),e.createElement("div",null,e.createElement(n.GenericCard,{onClick:()=>s(),className:"rounded-t-2xl",title:a?.snip24Enabled?"Create query permit":"Create new key",img:e.createElement("span",{className:"material-icons-round text-gray-400 mr-3"},"add_circle"),icon:e.createElement("span",{className:"material-icons-round text-gray-400"},"keyboard_arrow_right")}),e.createElement(n.CardDivider,null),e.createElement(n.GenericCard,{onClick:()=>C(),title:"Update key",img:e.createElement("span",{className:"material-icons-round text-gray-400 mr-3"},"edit"),icon:e.createElement("span",{className:"material-icons-round text-gray-400"},"keyboard_arrow_right")}),e.createElement(n.CardDivider,null),e.createElement(n.GenericCard,{onClick:()=>{r()},className:"rounded-b-2xl",title:e.createElement(h.Z,{size:"md"},"Import key"),img:e.createElement("span",{className:"material-icons-round text-gray-400 mr-3"},"content_paste"),icon:e.createElement("span",{className:"material-icons-round text-gray-400"},"keyboard_arrow_right")}))))}var Z=t(610675);function H(o){const c=(0,l.a74)();return e.createElement("div",null,e.createElement("div",{className:"flex items-center justify-center bg-white-100 dark:bg-gray-900 p-3 rounded-2xl mb-4"},e.createElement("span",{className:"material-icons-round text-indigo-300 mr-3"},"info"),e.createElement(h.Z,{size:"md",className:"font-bold text-center"},"Note down the viewing key")),e.createElement("div",{className:"flex items-center bg-white-100 dark:bg-gray-900 p-4 rounded-2xl justify-center"},e.createElement(h.Z,{size:"md",className:"text-center font-bold"},(0,l.MDB)(o.generatedViewingKey??""))),e.createElement(n.Buttons.CopyToClipboard,{color:Z.w.getChainColor(c),onCopy:o.onCopy}))}var I=t(472415),V=t(128844),q=t(564510),Y=t(443438),te=t(472565),_=t.n(te),P=t(164012),ee=t(840575),ae=t(574358);function $(){const o=(0,ae.E)(),c=(0,ee.iJ)(),{setQueryPermits:a}=(0,l.WdY)(),{lcdUrl:s=""}=(0,l.U9i)(),C=(0,l.xxU)();return(0,e.useCallback)(async(r,y)=>{const x=await o(),i=await Y.KQ.create(s,C,x),g=(await _().storage.local.get([P.J$]))[P.J$]?.[r],p=g?(0,q.peR)(g,c):null,m=[...(p?JSON.parse(p):{contracts:[]}).contracts];m.includes(y)||m.push(y);const f=await i.createQueryPermit(r,"permit",m,["balance","history"]),v=G=>({[r]:G?(0,q.HIp)(JSON.stringify({contracts:m,permit:f}),c):{contracts:m,permit:f}});return a(v(!1)),await _().storage.local.set({[P.J$]:v(!0)}),f},[C,o,s,c,a])}var E=t(734770),A=t(170849),ie=t(953718);const re=(0,e.createContext)(null);function me({children:o}){const c=(0,ae.E)(),a=(0,l.faj)({getWallet:c}),s=(0,e.useMemo)(()=>({...a}),[a]);return e.createElement(re.Provider,{value:s},o)}function se(){const o=(0,e.useContext)(re);return(0,ie.h)(o!==null,"useSnip20ManageTokens must be used within SendContextProvider"),o}function de({isVisible:o,onClose:c,token:a,onSuccess:s}){const C=(0,N.a)(),[r,y]=(0,e.useState)(null),[x,i]=(0,e.useState)(!1),w=(0,E.a)(),K=$(),[g,p]=(0,e.useState)(null),u=(0,l.SFn)(),{lcdUrl:m}=(0,l.U9i)("secret"),f=(0,l.xxU)(),v=(0,l.DI5)(),{setContractAddress:G,userPreferredGasLimit:T,userPreferredGasPrice:b}=se();(0,e.useEffect)(()=>{a?.contractAddr&&G(a.contractAddr)},[a?.contractAddr]);const O=(0,e.useCallback)(()=>{y(null),i(!1),c()},[c]),M=(0,e.useCallback)(async()=>{if(i(!0),a?.snip24Enabled)K(u,a.contractAddr),O(),s();else if(r)O(),s();else{const{error:W,key:d}=await w(m??v.secret.apis.rest??"",f??"secret-4",u,a?.contractAddr,!1,{gasLimit:T,feeDenom:b?.denom,gasPriceStep:Number(b?.amount??0)});W?(p(W),i(!1)):(i(!1),y(d))}},[u,f,v.secret.apis.rest,O,K,w,r,m,s,a?.contractAddr,a?.snip24Enabled,T,b?.amount,b?.denom]);return e.createElement(U.Z,{isOpen:o,onClose:O,title:a?.snip24Enabled?"Create query permit":"Create Viewing Key"},e.createElement("div",null,e.createElement("div",{className:"py-5 rounded-2xl bg-white-100 dark:bg-gray-900 mb-4"},e.createElement(h.Z,{size:"xs",className:"font-bold px-5",color:"text-gray-200"},a?.snip24Enabled?"Create query permit":"Create Viewing Key"),e.createElement(n.GenericCard,{className:"w-[300px] px-0",title:a?.symbol,subtitle:a?.name,img:e.createElement("img",{src:a?.icon===""?C:a?.icon,className:"w-[40px] h-[40px] mr-3"})})),!r&&!a?.snip24Enabled?e.createElement(oe,null):null,r?e.createElement(H,{generatedViewingKey:r,onCopy:async()=>{await A.i.copyText(r)}}):null,g?e.createElement("div",{className:"mb-2"},e.createElement(I._,{text:g})):null,x?e.createElement("div",{className:"flex justify-center w-[344px]"},e.createElement(V.T,{color:Z.w.white100})):e.createElement(n.Buttons.Generic,{size:"normal",color:"#E18881",className:"w-[344px]",onClick:M},r?"Done":"Confirm")))}var le=t(608740),ue=t(863262),ge=t(595196);function oe(){const{gasOption:o,userPreferredGasLimit:c,userPreferredGasPrice:a,setGasOption:s,setUserPreferredGasPrice:C,setUserPreferredGasLimit:r,setGasError:y,recommendedGasLimit:x,gasError:i}=se(),w=(0,le.e7)(),[K,g]=(0,e.useState)(!1),[p,u]=(0,e.useState)({option:o,gasPrice:a??w.gasPrice}),m=(0,e.useCallback)(()=>{g(!1)},[]),f=(0,e.useCallback)(v=>{u(v)},[]);return(0,e.useEffect)(()=>{u({option:o,gasPrice:w.gasPrice})},[w.gasPrice]),(0,e.useEffect)(()=>{s(p.option),C(p.gasPrice)},[p,s,C]),e.createElement("div",{className:"mb-4"},e.createElement(le.ZP,{recommendedGasLimit:x.toString(),gasLimit:c?.toString()??x.toString(),setGasLimit:v=>r(Number(v.toString())),gasPriceOption:p,onGasPriceOptionChange:f,error:i,setError:y},e.createElement(ue.a,{setShowFeesSettingSheet:g}),i&&!K?e.createElement("p",{className:"text-red-300 text-sm font-medium mt-2 text-center"},i):null,e.createElement(ge.k,{showFeesSettingSheet:K,onClose:m,gasError:i})))}function fe({isVisible:o,onClose:c,type:a,token:s,onSuccess:C}){const r=(0,N.a)(),[y,x]=(0,e.useState)(!1),[i,w]=(0,e.useState)(""),[K,g]=(0,e.useState)(null),p=(0,E.a)(),[u,m]=(0,e.useState)(!1),f=(0,l.SFn)(),{lcdUrl:v}=(0,l.U9i)("secret"),G=(0,l.xxU)(),T=(0,e.useRef)(null),{setContractAddress:b,userPreferredGasLimit:O,userPreferredGasPrice:M}=se();(0,e.useEffect)(()=>{s?.contractAddr&&b(s.contractAddr)},[s?.contractAddr]),(0,e.useEffect)(()=>{T?.current&&T.current.focus()},[T]);const W=(0,e.useCallback)(()=>{x(!1),g(null),w(""),m(!1),c()},[c]),d=(0,e.useCallback)(async()=>{if(u)C(),W();else{x(!0);const S=await p(v??"",G??"",f,s?.contractAddr,a==="import",{key:i,gasLimit:O,feeDenom:M?.denom,gasPriceStep:Number(M?.amount??0)});S.error?(g(S.error),x(!1)):(m(!0),x(!1))}},[f,G,W,p,i,v,C,u,s?.contractAddr,a,O,M?.amount,M?.denom]);return e.createElement(U.Z,{isOpen:o,onClose:W,title:a==="import"?"Import viewing key":"Update viewing key"},e.createElement("div",null,e.createElement(n.GenericCard,{className:"rounded-2xl mb-4 p-4",title:s?.symbol,subtitle:s?.name,img:e.createElement("img",{src:s?.icon===""?r:s?.icon,className:"w-[40px] h-[40px] mr-4"})}),e.createElement(n.Input,{onChange:S=>{w(S.target.value),g(null)},placeholder:"enter key",className:"mb-4 w-[344px]",ref:T}),a!=="import"&&!u?e.createElement(oe,null):null,K?e.createElement("div",{className:"mb-2"},e.createElement(I._,{text:K,className:"mb-4"})):null,u?e.createElement(H,{generatedViewingKey:i,onCopy:async()=>{A.i.copyText(i)}}):null,y?e.createElement("div",{className:"flex justify-center w-[344px]"},e.createElement(V.T,{color:Z.w.white100})):e.createElement(n.Buttons.Generic,{size:"normal",color:"#E18881",disabled:!i||!!K,className:"w-[344px]",onClick:d},u?"Done":"Confirm")))}function Ee(){const o=(0,N.a)(),c=(0,R.s0)(),[a,s]=(0,e.useState)(""),[C,r]=(0,e.useState)(!1),[y,x]=(0,e.useState)(null),[i,w]=(0,e.useState)(!1),[K,g]=(0,e.useState)(!1),[p,u]=(0,e.useState)(!1),m=(0,Q.Z)().get("contractAddress")??void 0,{secretTokens:f}=(0,l.X0D)(),v=d=>{x(d),r(!0)};(0,e.useEffect)(()=>{m&&f[m]&&(v({...f[m],contractAddr:m}),r(!0))},[m,f]);const G=d=>{s(d.target.value)},T=(0,e.useMemo)(()=>Object.entries(f).filter(([d,S])=>{const X=a.toUpperCase();return d.toUpperCase().includes(X)||S.name.toUpperCase().includes(X)||S.symbol.toUpperCase().includes(X)}).map(([d,S])=>({...S,contractAddr:d})),[a]),b=(0,e.useCallback)(()=>{w(!1),g(!1),u(!1),r(!1),x(null)},[]),O=(0,e.useCallback)(()=>{u(!1),g(!1)},[]),M=(0,e.useCallback)(()=>b(),[b]),W=(0,e.useCallback)(()=>w(!1),[]);return e.createElement(me,null,e.createElement("div",{className:"relative w-[400px] overflow-clip"},e.createElement(B.Z,{header:e.createElement(n.Header,{action:{onClick:()=>c(-1),type:n.HeaderActionType.BACK},title:"Manage Tokens"})},e.createElement("div",{className:"w-full flex flex-col pt-6 pb-2 px-7 sticky top-[72px] bg-gray-50 dark:bg-black-100"},e.createElement("div",{className:"w-[344px] flex h-10 bg-white-100 dark:bg-gray-900 rounded-[30px]  mb-4 py-2 pl-5 pr-[10px]"},e.createElement("input",{placeholder:"search tokens",className:"flex flex-grow text-base text-gray-600 dark:text-gray-200  outline-none bg-white-0",onChange:G}),e.createElement("img",{src:D.r.Misc.Search})),e.createElement("div",{className:"overflow-y-auto pb-20"},T.length===0?e.createElement(L.S,{isRounded:!0,subHeading:a?"Please try again with something else":"",heading:a?"No results for \u201C"+(0,k.jr)(a)+"\u201D":"No Tokens",src:D.r.Misc.Explore}):null,e.createElement("div",{className:"rounded-2xl flex flex-col items-center mx-7 m-auto justify-center dark:bg-gray-900 bg-white-100"},T.map((d,S,X)=>{const ce=S===X.length-1,ye=S===0;return e.createElement(e.Fragment,{key:d.contractAddr},e.createElement(n.GenericCard,{onClick:()=>v(d),className:J()({"rounded-t-2xl":ye,"rounded-b-2xl":ce}),title:d.symbol,subtitle:d.name,icon:e.createElement("span",{className:"material-icons-round text-gray-400"},"add"),img:e.createElement("img",{src:d.icon===""?o:d.icon,className:"w-[28px] h-[28px] mr-2"})}),ce?null:e.createElement(n.CardDivider,null))}))))),e.createElement(z,{isVisible:C,onClose:()=>r(!1),onCreateViewingKey:()=>w(!0),onUpdateViewingKey:()=>g(!0),onImportViewingKey:()=>u(!0),token:y??void 0}),e.createElement(de,{isVisible:i,onClose:W,token:y??void 0,onSuccess:M}),e.createElement(fe,{isVisible:p||K,onClose:O,type:p?"import":"update",token:y??void 0,onSuccess:M})))}}}]);
