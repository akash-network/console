(self.webpackChunk_leap_cosmos_extension=self.webpackChunk_leap_cosmos_extension||[]).push([[3085],{675335:(k,I,i)=>{"use strict";i.d(I,{u:()=>y});var y=(h=>(h.signResponse="sign-response",h.signingPopupOpen="signing-popup-open",h.signTransaction="sign-transaction",h.signSeiEvmResponse="sign-sei-evm-response",h))(y||{})},367738:(k,I,i)=>{"use strict";i.d(I,{_d:()=>B,qe:()=>U});var y=i(964266),h=i(564510),J=i(395362),E=i(389320),F=i(675335),A=i(164012),j=i(336023),p=i.n(j),x=i(789405),K=i(105959),Z=i(472565),n=i.n(Z),N=i(348834).Buffer;const C=400,M=600;n().tabs.onRemoved.addListener(()=>{});async function D(){const e=await n().storage.local.get([A.Pw]);if(e[A.Pw])return JSON.parse(e[A.Pw])}const B=async()=>{const e=await D()??{};return Object.assign(h.NOo,Object.keys(e).reduce((s,t)=>(s[e[t].chainId]=t,s),{}),{"elgafar-1":"stargaze"})},m=async e=>{const s=await(0,y.eli)(),t=Object.values(s).filter(c=>c.enabled).map(c=>c.chainId),o=Object.values(s).filter(c=>c.enabled).map(c=>c.testnetChainId),r=await D()??{},a=Object.values(r).filter(c=>c.enabled).map(c=>c.chainId),l=[...t,...o,...a];return e.reduce((c,d)=>(c[d]=l.indexOf(d)!==-1,c),{})};async function U(e,s,t,o){const r=t.origin===E.x3||t.origin===E.s3;let a=!o;o&&e.forEach(d=>{(s?.[o]?.[d]||[]).includes(t?.origin)||(a=!0)});const l=await m(e),c=Object.keys(l).filter(d=>!!l[d]);return c.length&&r&&(a=!1,await(0,x.E)(e,[o],t.origin)),{validChainIds:c,isNewChainPresent:a}}const T=async()=>{const{connections:e={}}=await browser.storage.local.get(CONNECTIONS);return e},O=async()=>{const{"active-wallet":e={}}=await browser.storage.local.get([ACTIVE_WALLET]);return e},L=async()=>(await browser.storage.local.get([ACTIVE_WALLET_ID]))[ACTIVE_WALLET_ID];async function H(e,s){const[t,o]=await Promise.all([L(),T()]);return await U(e,o,s,t)}const w={},g={};async function u(){return w.length===0?void 0:[await browser.windows.get(w[0],{populate:!0})]}function R(e){return e?e.find(s=>s.id?s.type==="popup"&&Object.values(w).includes(s.id):!1):void 0}async function P(e,s){let t="index.html#/";e!=="login"&&(t=t+e),s&&(t=t+s);const o={width:C,height:M,type:"popup",left:0,top:0,url:t};if(w[t]||g[t])try{let r=w[t];if(!r){const l=await g[t];l.id&&(r=l.id)}const a=await browser.windows.get(r,{populate:!0});if(a.tabs?.length){const[l]=a.tabs;if(l?.id)await browser.tabs.update(l.id,{active:!0,url:t});else throw new Error("No tabs")}else throw new Error("No tabs")}catch(r){try{if(r.message.includes("No tab with id")){const a=browser.windows.create(o);g[t]=a;const l=await a;l.id&&(w[t]=l.id)}}finally{delete g[t]}}else try{const r=browser.windows.create(o);g[t]=r;const a=await r;return a.id&&(w[t]=a.id),a}finally{delete g[t]}}n().windows.onRemoved.addListener(e=>{Object.entries(w).forEach(([t,o])=>{o===e&&delete w[t]})});async function W(e){const[s,t]=await Promise.all([O(),T()]);return!!(t?.[s.id]?.[e?.chainId]||[]).includes(e.origin)}async function Q(e){const[s,t]=await Promise.all([O(),T()]);let o=t[s.id]?.[e?.chainId]||[];return o.includes(e.origin)?(o=o.filter(r=>r!==e.origin),t[s.id][e.chainId]=o,await browser.storage.local.set({[CONNECTIONS]:t}),!0):!1}async function f(){const e=await getChains();try{const t=(await browser.storage.local.get([BETA_CHAINS]))[BETA_CHAINS];return{...e,...JSON.parse(t??"{}")}}catch{return e}}async function z(e){const{"active-wallet":s}=await browser.storage.local.get([ACTIVE_WALLET]);let o=(await B())[e];return o=o==="cosmoshub"?"cosmos":o,s.addresses[o]}async function X(e){const s=await O(),t=`seed-phrase/${s.id}`,r=(await chrome.storage.local.get([t]))[t];if(r){const b=N.from(r,"hex");if(b.length===32)return b}const a=await z("secret-4"),l=getStorageAdapter();initStorage(l);const c=await KeyChain.getSigner(s.id,e,{addressPrefix:"secret",coinType:"529"}),d=CryptoJs.SHA256(await c.signAmino(a,N.from(JSON.stringify({account_number:0,chain_id:"secret-4",fee:[],memo:"Create leap Secret encryption key. Only approve requests by Leap.",msgs:[],sequence:0}))));return await chrome.storage.local.set({[`seed-phrase/${s.id}`]:d.toString()}),N.from(d.toString())}function Y(e){const s=new RegExp(/^(http|https):\/\/[^ "]+$/),t=new RegExp(/^\d+$/);if(!s.test(e.rpc))throw new Error("Invalid RPC URL");if(!s.test(e.rest))throw new Error("Invalid REST URL");if(!t.test(e.bip44.coinType))throw new Error("Invalid bip44 coin type");if(e.feeCurrencies?.length<1)throw new Error("Invalid fee currencies")}function v(e){const s=(t,o)=>{if(o.id!==browser.runtime.id)throw new Error("Invalid sender");t.type==="approval-popup-open"&&(browser.runtime.sendMessage({type:"enable-access",payload:e}),browser.runtime.onMessage.removeListener(s))};browser.runtime.onMessage.addListener(s)}async function _(e){return new Promise((s,t)=>{const o=r=>{r.type===e&&(r.payload.status==="success"?s("success"):t("failed"),browser.runtime.onMessage.removeListener(o))};browser.runtime.onMessage.addListener(o)})}async function S(e){return new Promise((s,t)=>{const o=async(r,a)=>{a.id!==browser.runtime.id&&t("Invalid sender"),r.type==="chain-enabled"&&r.payload.payloadId===e?s({status:"success",payloadId:r.payload.payloadId}):r.type==="chain-approval-rejected"&&r.payload.payloadId===e?(t({status:"rejected",payloadId:r.payload.payloadId}),browser.runtime.onMessage.removeListener(o)):r.type==="popup-closed"?(s("popup-closed"),browser.runtime.onMessage.removeListener(o)):r.type==="user-logged-in"&&r.status!=="success"&&(t("failed"),browser.runtime.onMessage.removeListener(o))};browser.runtime.onMessage.addListener(o)})}function G(e){const s=(t,o)=>{if(o.id!==browser.runtime.id)throw new Error("Invalid Sender");t.type===MessageTypes.signingPopupOpen&&(browser.runtime.sendMessage({type:MessageTypes.signTransaction,payload:e}),browser.runtime.onMessage.removeListener(s))};browser.runtime.onMessage.addListener(s)}async function q(e){return new Promise((s,t)=>{const o=r=>{r.type===e&&(r.payload.status==="success"?s(r.payload.data):t(r.payload.data),browser.runtime.onMessage.removeListener(o))};browser.runtime.onMessage.addListener(o)})}},214402:(k,I,i)=>{"use strict";i.r(I),i.d(I,{default:()=>g});var y=i(964266),h=i(339279),J=i(294184),E=i.n(J),F=i(782877),A=i(896538),j=i(128844),p=i(94608),x=i(164012),K=i(367738),Z=i(905865),n=i(202784);const N=()=>{const[u,R]=(0,n.useState)(()=>({width:window.innerWidth,height:window.innerHeight}));return(0,n.useEffect)(()=>{function P(){R({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[]),u};var C=i(508181),M=i(610675),D=i(15815),B=i(472565),m=i.n(B),U=i(789405);const T=({name:u})=>n.createElement("div",{className:"flex flex-col align-middle justify-center m-auto"},n.createElement(p.Z,{size:"lg",className:"font-bold mt-3 mx-2 justify-center align-middle truncate"},u),n.createElement(p.Z,{size:"md",className:"justify-center align-middle mb-2",color:"text-gray-200"},"wants to connect to your wallet")),O=({name:u})=>n.createElement("div",{className:"flex flex-row align-middle justify-center m-auto"},n.createElement("img",{src:C.r.Misc.LockGreen,className:"h-[14px] mr-2 m-auto"}),n.createElement(p.Z,{size:"md",className:"justify-center align-middle",color:"text-green-500"},u));function L(){m().runtime.sendMessage({type:"popup-closed"}),setTimeout(()=>{window.close()},50)}async function H(u){try{await m().runtime.sendMessage(u)}catch{}}const g=()=>{const[u,R]=(0,n.useState)([]),{width:P}=N(),[W,Q]=(0,n.useState)([]),[f,z]=(0,n.useState)(!1),[X,Y]=(0,n.useState)(!1),[v,_]=(0,n.useState)([]),S=(0,y.rTu)(),{chains:G}=(0,y._IL)(),q=(0,Z.a)(),e=(0,n.useMemo)(()=>(0,D.l)()?[{chain:"seiTestnet2",payloadId:"123"}]:W.reduce((l,c)=>(l.find(b=>b.chain===c.chain)||l.push(c),l),[]),[W]),s=(0,n.useCallback)(async()=>{if(!v[0]){L();return}for(const a of v){const l=a?.validChainIds??[a?.[0]?.chainId];await H({type:"chain-approval-rejected",payload:{origin,chainsIds:l,payloadId:a.payloadId,ecosystem:a.ecosystem},status:"failed"})}window.removeEventListener("beforeunload",s),L()},[v]);(0,n.useEffect)(()=>{S&&R([S])},[S]),(0,n.useEffect)(()=>(window.addEventListener("beforeunload",s),m().storage.local.remove(x.u1),()=>{window.removeEventListener("beforeunload",s)}),[v]);async function t(a,l){if(l.id===m().runtime.id&&a.type==="enable-access"){const c=await m().storage.local.get([x.vA,x.pV]),d=c[x.vA]||[],b=c[x.pV],V=a.payload.validChainIds??[a.payload.chainId??""],{isNewChainPresent:ee}=await(0,K.qe)(V,d,{origin:a.payload.origin},b.id);if(ee){_($=>[...$,a.payload]);const te=(await(0,K._d)())[V[0]];Q($=>[...$,{chain:te,payloadId:a.payload.payloadId}]),Y(!0)}else await m().runtime.sendMessage({type:"chain-enabled",payload:{origin,chainsIds:V,payloadId:a.payload.payloadId,ecosystem:a.payload.ecosystem,ethMethod:a.payload.ethMethod},status:"success"}),L()}}(0,n.useEffect)(()=>(m().runtime.sendMessage({type:"approval-popup-open"}),m().runtime.onMessage.addListener(t),()=>{m().runtime.onMessage.removeListener(t)}),[]);const o=async()=>{for await(const a of v){const l=a?a?.validChainIds??[a[0]?.chainId]:void 0;if(!l)return;const c=u.map(d=>d.id);await(0,U.E)(l,c,a.origin),await H({type:"chain-enabled",payload:{origin,chainsIds:l,payloadId:a.payloadId,ecosystem:a.ecosystem,ethMethod:a.ethMethod},status:"success"})}window.removeEventListener("beforeunload",s),L()},r=P&&P>800;return X?n.createElement("div",{className:"relative w-screen max-w-3xl h-full self-center px-5"},n.createElement("div",{className:"flex flex-col mx-auto max-w-2xl box-border h-full overflow-scroll py-5"},n.createElement(A.h,{HeadingComponent:()=>n.createElement(T,{name:v?.[0]?.origin||"Connect Leap"}),SubTitleComponent:()=>n.createElement(O,{name:v?.[0]?.origin})}),n.createElement("div",{className:E()("bg-white-100 dark:bg-gray-900 rounded-2xl py-4",{"h-[405px]":f,"h-[230px]":!f&&e.length>1,"h-[100px]":e.length<=1})},n.createElement("div",{className:E()("flex items-center px-5 mb-4",{"cursor-pointer":f}),onClick:()=>z(!1)},n.createElement("img",{src:C.r.Misc.WalletIconTeal,className:"h-[20px] w-[20px] mr-3"}),n.createElement(p.Z,{size:"md",className:"text-white-100 font-bold"},`Connecting ${S?.name}`),e?.length>1&&f?n.createElement("span",{className:"h-[16px] w-[16px] ml-auto material-icons-round text-gray-500"},"keyboard_arrow_up"):null),n.createElement("div",{className:E()("flex flex-col overflow-auto",{"h-[340px] mb-2":f,"h-[120px] mb-2":!f&&W.length>1,"h-[16px] mb-4":W.length<=1})},e.map((a,l)=>{const c=l===e.length-1;return n.createElement(n.Fragment,{key:a.payloadId},n.createElement("div",{className:E()("flex items-center px-5",{"py-2.5":e.length>1}),style:{display:l<=2||f?"flex":"none"}},n.createElement("img",{src:G[a.chain].chainSymbolImageUrl??q,className:"h-[16px] w-[16px] mr-2"}),n.createElement(p.Z,{size:"xs",color:"text-gray-400"},G[a.chain].chainName),n.createElement(p.Z,{className:"ml-auto",size:"xs",color:"text-gray-400"},(0,y.Hnh)(u?.[0]?.addresses[a.chain]))),n.createElement("div",{className:"px-5",style:{display:l<=1||f?"block":"none"}},c?null:F.iz))})),!f&&e.length>3?n.createElement("button",{onClick:()=>z(!0),className:"flex w-full px-5"},n.createElement(p.Z,{size:"xs",color:"text-osmosisPrimary",className:"ml-auto"},`view more (${e.length-3})`)):null),f?null:n.createElement("div",{className:"flex flex-col gap-y-[10px] bg-white-100 dark:bg-gray-900 rounded-2xl px-4 py-5 mt-4"},n.createElement(p.Z,{size:"xs",color:"text-gray-300 mb-1"},"This app will be able to"),n.createElement(p.Z,{size:"sm"},n.createElement("img",{src:C.r.Misc.GreenTick,className:"h-[12px] mr-3 my-auto"}),"View your wallet balance and activity"),n.createElement(p.Z,{size:"sm"},n.createElement("img",{src:C.r.Misc.GreenTick,className:"h-[12px] mr-3 my-auto"}),"Request approval for transactions."),n.createElement("div",{className:"my-1 border-[0.05px] border-solid border-white-100 dark:border-gray-800 opacity-50"}),n.createElement(p.Z,{size:"xs",color:"text-gray-300 mb-1"},"This app won't be able to"),n.createElement(p.Z,{size:"sm"},n.createElement("img",{src:C.r.Misc.GreyCross,className:"h-[12px] mr-3 my-auto"}),"Move funds without your permission")),n.createElement("div",{className:`fixed bottom-0 left-0 px-5 py-3 flex bg-white-0 dark:bg-black-100 flex-row w-full ${r?"justify-center gap-4":"justify-between gap-2"}`},n.createElement(h.Buttons.Generic,{style:{height:"48px",background:M.w.gray900,color:M.w.white100},onClick:s},"Cancel"),n.createElement(h.Buttons.Generic,{style:{height:"48px",background:M.w.cosmosPrimary,color:M.w.white100},className:"bg-gray-800",onClick:o,disabled:u.length<=0},"Connect")))):n.createElement("div",{className:"relative w-screen max-w-3xl h-full self-center p-5 pt-0"},n.createElement("div",{className:"flex justify-center items-center h-[600px]"},n.createElement(j.Z,null)))}},150633:()=>{}}]);
