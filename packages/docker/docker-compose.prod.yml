services:
  api:
    restart: always
    environment:
      PORT: 3000
      DB_HOST: db
    ports:
      - '3080:3000'
    depends_on:
      - vault

  indexer:
    restart: always
    env_file:
      - .env.sandbox.docker-compose-dev

  provider-proxy:
    restart: always
    environment:
      PORT: 3000
    ports:
      - '3040:3000'

  deploy-web:
    restart: always
    environment:
      API_HOST: api
    env_file:
      - .env.sandbox.docker-compose-dev
    ports:
      - '3000:3000'
    depends_on:
      - api
      - provider-proxy

  stats-web:
    restart: always
    env_file:
      - .env.sandbox.docker-compose-dev
    ports:
      - '3001:3000'
    depends_on:
      - api
      - provider-proxy

  provider-console:
    restart: always
    env_file:
      - .env.sandbox.docker-compose-dev
    ports:
      - '3003:3000'

  vault:
    image: hashicorp/vault
    network_mode: "host"
    ports:
      - "8200:8200"
    volumes:
      - ./file:/vault/file:rw
      - ./config:/vault/config:rw
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: "myroot"
      VAULT_ADDR: "http://127.0.0.1:8200"
    cap_add:
      - IPC_LOCK
    entrypoint: vault server -dev -dev-root-token-id=myroot
